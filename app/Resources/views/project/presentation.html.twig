
{% extends 'base.html.twig' %}

{% block title %}
    {{ project.projectName }}
{% endblock %}

{% set formClass = {'attr': {'class':'form-control','disabled':'' } } %}

{% block body %}
    {% if is_granted('ROLE_USER') %}
        {% include 'toolbar.html.twig' %}
    {% endif %}
    <div class="container-fluid">
        <div class="row">
            <div class="col-xs-12 col-sm-6">
                <div class="col-xs-6">
                    <h2>Project "{{ project.projectName }}" </h2>
                </div>
                <div class="col-xs-6" >
                    <h4>
                        Leader : {{ project.leader.username }} 
                    </h4>
                    <h4>
                        Secretary : {{ project.secretary.username }}
                    </h4>
                </div>

                {% if project.roles|length %}
                    <h3>Other roles :</h3>
                    <ul class="list-group" >
                        {% for ro in project.roles %}
                            <li class="list-group-item" >
                                <strong>{{ ro.student.username }}</strong> :
                                {{ ro.roleName }}
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <h3>No other roles</h3>
                {% endif %}

                {% if project.participants|length %} 
                    <h3>Participants :</h3>
                    <ul class="list-group" >
                        {% for part in project.participants %}
                            <li class="list-group-item" >
                                {{ part.username }}
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <h3>No participants (this means no leader nor secretary)</h3>
                {% endif %}
                {% if project.meetings|length %}
                    <h3>Meetings : </h3>
                    <ul class="list-group" >
                        {% for meet in project.meetings %} 
                            <li class="list-group-item" >
                                Meeting at  {{ meet.date|date('d/m/Y H:i') }}
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <h3>No meetings (at all) for this project</h3>
                {% endif %}
                {% if is_granted('ROLE_ADMIN') %}
                    {% if project.locked %}
                        <a class="btn btn-success" 
                           href="{{ path('unlockproject',{'proj' : project.id}) }}">
                            <i class="fa fa-unlock" ></i>
                            Unlock
                        </a>
                    {% else %}
                        <a class="btn btn-warning"
                           href="{{ path('lockproject',{'proj' : project.id}) }}">
                            <i class="fa fa-lock" ></i>
                            Lock
                        </a>
                    {% endif %}
                    <a class="btn btn-danger"
                       href="{{ path('deleteproject',{'projId': project.id}) }}">
                        <i class="glyphicon glyphicon-trash" ></i>
                        Delete
                    </a>
                {% endif %}
            </div>
            <div class="col-xs-12 col-sm-6">
                {% if form %}
                    <script src="{{ asset('assets/js/addRoles.js') }}" ></script>
                    {{ form_start(form) }}
                    <h4>Roles :</h4>
                    <ul id="roles-fields-list"
                        data-prototype="{{ form_widget(form.roles.vars.prototype)|e }}"
                        class="list-group">
                        {% for roleField in form.roles %}
                            <li class="role-line list-group-item form-group-sm row" >
                                {{ form_errors(roleField) }}
                                <div class="col-xs-12 col-sm-4">
                                    <label>Student :</label>
                                    {{ form_widget(roleField.student,formClass) }}
                                </div>
                                <div class="col-xs-12 col-sm-4" >
                                    <label>Role name :</label>
                                    {{ form_widget(roleField.roleName,formClass) }}
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                    <div class="row">
                        <a class="btn btn-default" href="#" id="add-role">
                            <i class="glyphicon glyphicon-plus" ></i>
                            Add a role
                        </a>
                    </div>
                    <h4>Meetings :</h4>
                    <ul id="meetings-fields-list"
                        data-prototype="{{ form_widget(form.meetings.vars.prototype)|e }}"
                        class="list-group">
                        {% for meetingField in form.meetings %}
                            <li class="meeting-line list-group-item row" >
                                {{ form_errors(meetingField) }}
                                <div class="col-xs-12 col-sm-3">
                                    <label>Date : </label>
                                    {{ form_widget(meetingField.date.date,formClass) }}
                                </div>
                                <div class="col-xs-12 col-sm-3">
                                    <label>Hour : </label>
                                    {{ form_widget(meetingField.date.time,formClass) }}
                                </div>
                                <div class="col-xs-12 col-sm-3">
                                    <label>Room :</label>
                                    {{ form_widget(meetingField.room,formClass) }}
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                    <div class="row">
                        <a class="btn btn-default" href="#" id="add-meeting" >
                            <i class="glyphicon glyphicon-plus" ></i>
                            Create a meeting
                        </a>
                    </div>

                    <div class="row" >
                        <button class="btn btn-success" type="submit">
                            <i class="glyphicon glyphicon-save" ></i>
                            Save modifications
                        </button>
                    </div>
                    {{ form_end(form) }}
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}

